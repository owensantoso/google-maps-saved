<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Mobile Responsive Meta Tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Places Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      padding: 0;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      margin-top: 20px;
      font-size: 1.5em;
    }
    #searchInput {
      width: 95%;
      max-width: 600px;
      display: block;
      margin: 20px auto;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #results {
      width: 95%;
      max-width: 600px;
      margin: 0 auto;
    }
    .place {
      background: #fff;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .place h3 {
      margin: 0 0 10px;
      font-size: 1.2em;
    }
    .place h3 a {
      text-decoration: none;
      color: #0066cc;
    }
    .place h3 a:hover {
      text-decoration: underline;
    }
    .place p {
      margin: 5px 0;
      line-height: 1.4;
      font-size: 0.95em;
    }
    .tags {
      font-size: 0.9em;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Search Places</h1>
  <input type="text" id="searchInput" placeholder="Search by tag, name, note, etc.">
  <div id="results"></div>

  <script>
    let places = [];

    // Load the JSON file
    fetch('places.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok: ' + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        console.log('Data loaded successfully:', data);
        places = data.places;
        displayResults(places);
      })
      .catch(error => {
        console.error('Error loading places.json:', error);
        document.getElementById('results').innerHTML = '<p>Error loading data.</p>';
      });

    // Listen for search input changes
    document.getElementById('searchInput').addEventListener('input', function() {
      const query = this.value.toLowerCase().trim();
      const queryWords = query ? query.split(/\s+/) : [];
      
      const filtered = places.filter(place => {
        // Combine searchable fields using both lowercase and capitalized keys
        const combined = [
          place.title || place.Title || '',
          place.note || place.Note || '',
          place.comment || place.Comment || '',
          ...(place.tags || [])
        ].join(' ').toLowerCase();

        return queryWords.every(word => combined.includes(word));
      });
      displayResults(filtered);
    });

    // Display the results on the page.
    function displayResults(results) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      if (results.length === 0) {
        resultsDiv.innerHTML = '<p>No results found.</p>';
        return;
      }

      results.forEach(place => {
        const placeDiv = document.createElement('div');
        placeDiv.className = 'place';

        // Use Title property if available, otherwise fallback to lowercase key
        const titleText = place.title || place.Title || 'Untitled';
        const noteText = place.note || place.Note || '';
        const commentText = place.comment || place.Comment || '';
        const urlText = place.url || place.URL || '';
        const tagsArray = place.tags || [];

        // Create a clickable title linking to the URL
        const title = document.createElement('h3');
        if (urlText) {
          const link = document.createElement('a');
          link.href = urlText;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.textContent = titleText;
          title.appendChild(link);
        } else {
          title.textContent = titleText;
        }
        placeDiv.appendChild(title);

        if (noteText) {
          const note = document.createElement('p');
          note.textContent = noteText;
          placeDiv.appendChild(note);
        }

        if (commentText) {
          const comment = document.createElement('p');
          comment.textContent = commentText;
          placeDiv.appendChild(comment);
        }

        if (tagsArray.length > 0) {
          const tags = document.createElement('p');
          tags.className = 'tags';
          tags.textContent = 'Tags: ' + tagsArray.join(', ');
          placeDiv.appendChild(tags);
        }

        resultsDiv.appendChild(placeDiv);
      });
    }
  </script>
</body>
</html>